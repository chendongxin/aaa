<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hqjy.mustang.transfer.export.dao.SellCallDao">

    <resultMap id="baseMap" type="com.hqjy.mustang.transfer.export.model.entity.CustomerEntity">
        <result property="deptId" column="deptId"/>
        <result property="num" column="num"/>
    </resultMap>

    <select id="countConnect" resultMap="baseMap">
		SELECT COUNT(DISTINCT customer_id) AS num, create_user_dept_id AS deptId
		FROM transfer_call_record
		inner join transfer_customer tc on tc.customer_id = transfer_call_record.customer_id
		WHERE status = false
		AND create_time BETWEEN #{beginTime} AND #{endTime} AND create_user_id = userId AND dept_id IN ${deptIds}
		GROUP BY create_user_id
	</select>

    <select id="countCall" resultMap="baseMap">
		SELECT COUNT(DISTINCT customer_id) AS num, create_user_dept_id AS deptId
		FROM transfer_call_record
		inner join transfer_customer tc on tc.customer_id = transfer_call_record.customer_id
		WHERE create_time BETWEEN #{beginTime} AND #{endTime} AND create_user_id = userId AND dept_id IN ${deptIds}
		GROUP BY create_user_id
	</select>

    <select id="countCallTimeConnect" resultMap="baseMap">
		SELECT SUM(TIME_TO_SEC(total_duration)) AS duration, create_user_dept_id AS deptId
		FROM transfer_call_record
		inner join transfer_customer tc on tc.customer_id = transfer_call_record.customer_id
        WHERE create_time BETWEEN #{beginTime} AND #{endTime} AND create_user_id = userId AND dept_id IN ${deptIds}
        GROUP BY create_user_id
	</select>

</mapper>